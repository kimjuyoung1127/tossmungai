네, 제공해주신 방대한 문서를 AI가 이해하기 쉬운 **핵심 규칙과 요구사항**으로 요약 정리했습니다.

우리 `멍멍AI` 프로젝트 개발 및 출시에 **필수적인 내용**만 선별했습니다.

---

## 1. 🚀 핵심 아키텍처 및 API (Plan B 검증)

* **mTLS 인증 필수:** **'토스 로그인', '토스페이'** 등 모든 서버 API는 **mTLS 인증서** 기반의 서버 간 통신이 **필수**입니다. (우리의 Supabase Edge Function + Deno `createHttpClient` 접근 방식이 올바른 방향임을 재확인했습니다.)
* **로그인 흐름 (Plan B):**
    1.  **클라이언트:** SDK의 `appLogin()` 함수를 호출하여 `authorizationCode`와 `referrer`를 받습니다. (이 함수는 **샌드박스 앱에서도 작동**합니다.)
    2.  **백엔드 (Edge Function):** 이 `authorizationCode`를 `/generate-token` API로 보내 `accessToken`을 받습니다. (mTLS 필요)
    3.  **백엔드 (Edge Function):** `accessToken`을 헤더에 담아 `/login-me` API를 호출하여 **암호화되지 않은 `userKey`**와 **암호화된 개인정보(PII)**를 받습니다. (mTLS 필요)
* **PII (개인정보):** `userKey`를 제외한 `name`, `phone`, `ci` 등은 **AES-256-GCM**으로 암호화되어 있습니다. 이를 사용하려면 콘솔에서 받은 **'복호화 키'**와 **'AAD'**가 필요합니다. (우리 DB 스키마 v3.7의 `*_encrypted` 필드 및 `ci_hash` 설계가 타당함을 의미합니다.)
* **SDK 초기화:** `granite.config.ts`의 `plugins: [ appsInToss({...}) ]` 설정과 `_app.tsx`의 `AppsInToss.registerApp(App, { context });` 구조가 SDK 초기화의 핵심입니다.

---

## 2. 💳 결제 (토스페이)

* **결제 방식:** 훈련사 매칭과 같은 실물/서비스 결제는 **'토스페이'**를 사용합니다. ('인앱결제'는 디지털 상품 전용이므로 우리와 관련 없습니다.)
* **결제 흐름 (3단계):**
    1.  **결제 생성 (서버):** Edge Function이 `/make-payment` API를 호출 (mTLS + `x-toss-user-key` 헤더 필요) → `payToken` 획득. (이때 `orderNo`는 유니크해야 함 - 우리 `bookings.id` 사용 전략 유효)
    2.  **결제 인증 (클라이언트):** 앱이 `payToken`으로 SDK의 `checkoutPayment` 함수 호출 → 사용자 인증.
    3.  **결제 실행 (서버):** 앱이 `payToken`과 `orderNo`를 Edge Function으로 전달 → Edge Function이 `/execute-payment` API 호출 (mTLS + `x-toss-user-key` 헤더 필요) → **최종 승인.**
* **필수 헤더:** 모든 결제 API 서버 통신은 `x-toss-user-key` 헤더가 필수입니다. (Edge Function이 Supabase `users` 테이블에서 `toss_user_key`를 조회하여 사용해야 함)
* **키:** 토스페이는 **앱인토스 전용 키**를 사용해야 합니다. (콘솔 등록)

---

## 3. 🎨 브랜딩 및 UI/UX (필수 준수 사항)

* **브랜드 설정 (granite.config.ts):**
    * `displayName`: **한글** 이름 사용 (예: `멍멍AI`)
    * `primaryColor`: `#` 포함 헥스코드 (예: `#3182F6`)
    * `icon`: 로고 이미지 주소 (600x600 정방형, **라운드 처리 불가**, 배경색 필수)
* **시스템 모드:** **다크 모드 미지원.** 앱은 **라이트 모드** 기준으로 설정해야 합니다.
* **확대/축소:** **제스처를 통한 화면 확대/축소 기능은 기본적으로 금지**됩니다. (지도 등 예외적인 경우만 허용)
* **내비게이션 바:** 토스 전용 컴포넌트가 제공되며 **커스텀이 불가**합니다. (로고, 이름, 홈, 닫기 버튼 등)
* **탭바:** 필요시 직접 구현하되, **반드시 토스 제공 '플로팅' 형태**를 따라야 합니다. (최소 2개, 최대 5개)

---

## 4. 🚫 다크패턴 및 출시 반려 (Rejection) 사유

* **즉시 팝업 금지:** 서비스 진입 **즉시** 바텀싯/팝업(광고, 알림 동의 포함) 노출 시 **출시 반려**됩니다.
* **뒤로가기 방해 금지:** `Back` 버튼 클릭 시 이탈을 막는 팝업(알림 동의 등) 노출 시 **출시 반려**됩니다.
* **강제 행동 금지:** '닫기', '거절' 등 사용자의 선택지가 없는 화면(강제 CTA 유도)은 **출시 반려**됩니다.
* **예상치 못한 광고 금지:** 사용자의 일반적인 흐름(메뉴 클릭 등)을 방해하는 전면 광고 노출 시 **출시 반려**됩니다.
* **기능 제한:** 미니앱에서 제공하지 않는 기능(예: '자사 앱 전용') 버튼을 노출하거나, 접속 불가능한 버튼을 포함하면 **출시 반려**됩니다.
* **자사 앱/웹 유도 금지:** 미니앱 내에서 자사 앱 설치나 웹사이트로의 직접적인 유도는 **금지**됩니다.
* **인트로 필수:** 토스 로그인 사용 시, 서비스 소개 없이 **곧바로 로그인 화면을 유도하는 것은 허용되지 않습니다.** (인트로 화면 필수)

---

## 5. ✍️ UX 라이팅 (문구)

* **톤:** **'해요체'** 사용 (합쇼체 X)
* **표현:** **능동적** ("했어요" O, "됐어요" X), **긍정적** ("할 수 있어요" O, "없어요" X) 표현 사용.
* **경어:** 과도한 경어 ("~시겠어요?", "~께") 사용 금지. **캐주얼한 경어** 사용.
* **오류 메시지:** 단순 "실패"가 아닌, **상황 설명, 원인, 해결책**을 명확히 제시해야 합니다.

---

## 6. 📦 테스트 및 배포

* **샌드박스:** `npm run dev` + `adb reverse`로 로컬 개발 및 테스트. (`appLogin`, `TossPay` 테스트 가능)
* **실제 앱 테스트:**
    1.  `npm run build`로 **`.ait` 번들 파일** 생성.
    2.  `.ait` 파일은 **압축 해제 기준 100MB 이하**여야 함. (리소스 분리 필수)
    3.  콘솔에 `.ait` 업로드 후 **'테스트하기' QR 코드**를 **'일반 토스 앱'**으로 스캔하여 최종 테스트.
* **출시:** 테스트가 1회 이상 완료되어야 **'검토 요청하기'** 버튼이 활성화됩니다. (영업일 3일 소요)
* **피처:** 비게임 미니앱은 **최소 1개 ~ 최대 3개**의 '앱 내 기능'(피처)을 등록해야 합니다. (예: `intoss://mungai/recommend`, `intoss://mungai/search`)